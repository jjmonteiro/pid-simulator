<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PID Controller Simulation</title>
    <style>
        .container {
            width: 300px;
            margin: auto;
            text-align: center;
        }
        .bar-container {
            height: 20px;
            width: 100%;
            background-color: #ddd;
            margin: 10px 0;
            position: relative;
            border-radius: 5px;
        }
        .bar {
            height: 100%;
            border-radius: 5px;
            text-align: center;
            line-height: 20px;
            color: white;
            font-size: 12px;
            overflow: hidden;
        }
        .measured-bar {
            background-color: #4caf50;
        }
        .control-bar {
            background-color: #f44336;
        }
        label, input {
            display: inline-block;
            margin: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>PID Controller Simulation</h1>
        <div>
            <label for="kp">Kp:</label>
            <input type="number" id="kp" value="1.0" step="0.1">
            <label for="ki">Ki:</label>
            <input type="number" id="ki" value="0.1" step="0.1">
            <label for="kd">Kd:</label>
            <input type="number" id="kd" value="0.05" step="0.01">
        </div>
        
        <label for="negativeControl">Enable Negative Control:</label>
        <input type="checkbox" id="negativeControl">

        <h2>Setpoint: <span id="setpoint">25.00</span> 째C</h2>
        <h2>Measured Value: <span id="measuredValue">22.00</span> 째C</h2>
        
        <div>Control Output: <span id="controlOutput">0.00</span>%</div>

        <div class="bar-container">
            <div id="measuredValueBar" class="bar measured-bar" style="width: 50%;">22째C</div>
        </div>
        
        <div class="bar-container">
            <div id="controlOutputBar" class="bar control-bar" style="width: 0%;">0%</div>
        </div>
        
        <button onclick="resetSystem()">Reset</button>
    </div>

    <script>
    
            // PID Control Constants and Initial State
        let Kp = 1.0, Ki = 0.1, Kd = 0.05;
        let previousError = 0;
        let integral = 0;
        let setpoint = 25.0;  // Target temperature
        let measuredValue = 22.0;  // Current temperature (e.g., read from sensor)
        let coolingFactor = 0.8;  // Factor for cooling (when negative control is disabled)

        // DOM Elements
        const setpointDisplay = document.getElementById('setpoint');
        const measuredValueDisplay = document.getElementById('measuredValue');
        const controlOutputDisplay = document.getElementById('controlOutput');
        const measuredValueBar = document.getElementById('measuredValueBar');
        const controlOutputBar = document.getElementById('controlOutputBar');

        // Reset the system
        function resetSystem() {
            measuredValue = 22.0;
            integral = 0;
            previousError = 0;
        }

        // Update PID calculation with heating and cooling
        function updatePID() {
            let error = setpoint - measuredValue;
            integral += error;
            let derivative = error - previousError;

            // Retrieve values from input fields
            Kp = parseFloat(document.getElementById('kp').value);
            Ki = parseFloat(document.getElementById('ki').value);
            Kd = parseFloat(document.getElementById('kd').value);

            // Calculate control output using PID formula
            let controlOutput = (Kp * error) + (Ki * integral) + (Kd * derivative);

            // Check if negative control is enabled
            let negativeControlEnabled = document.getElementById('negativeControl').checked;
            
            if (!negativeControlEnabled && measuredValue > setpoint) {
                // Apply cooling by reducing the control output
                controlOutput *= -coolingFactor;
            }

            // Clamp control output between 0 and 100%
            controlOutput = Math.max(0, Math.min(controlOutput, 100));

            // Update display and bar progress
            updateDisplay(setpoint, measuredValue, controlOutput);
            
            // Save the current error for the next loop iteration
            previousError = error;
        }

        // Update the webpage with PID values and progress bars
        function updateDisplay(setpoint, measuredValue, controlOutput) {
            setpointDisplay.textContent = setpoint.toFixed(2);
            measuredValueDisplay.textContent = measuredValue.toFixed(2);
            controlOutputDisplay.textContent = controlOutput.toFixed(2);

            // Update measured value bar
            let measuredBarPercentage = (measuredValue / 100) * 100;  // Scale to 100%
            measuredValueBar.style.width = `${Math.min(measuredBarPercentage, 100)}%`;
            measuredValueBar.textContent = `${measuredValue.toFixed(2)}째C`;

            // Update control output bar
            controlOutputBar.style.width = `${controlOutput}%`;
            controlOutputBar.textContent = `${controlOutput.toFixed(2)}%`;
        }

        // Simulate the heating/cooling system (run every second)
        function simulate() {
            // Simulate temperature change (heating or cooling)
            let randomFluctuation = (Math.random() - 0.5) * 2;
            measuredValue += randomFluctuation;
            updatePID();  // Update PID calculation and display

            setTimeout(simulate, 1000);  // Run the next simulation step every second
        }

        // Start simulation
        simulate();

    
    </script>
</body>
</html>
